{"ast":null,"code":"import axios from \"axios\";\nimport { parseCookies, setCookie } from \"nookies\";\nimport { signOut } from \"../contexts/AuthContext\";\nvar cookies = parseCookies();\nvar isRefreshing = false;\nvar failedRequestQueue = [];\nexport var api = axios.create({\n  baseURL: \"http://54.94.41.183:3333\",\n  headers: {\n    Authorization: \"Bearer \".concat(cookies[\"0dayTokenFront.token\"])\n  }\n});\napi.interceptors.response.use(function (response) {\n  return response;\n}, function (error) {\n  if (error.response.status === 401) {\n    var _error$response$data;\n\n    if (((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.code) === \"token.expired\") {\n      cookies = parseCookies();\n      var _cookies = cookies,\n          refreshToken = _cookies[\"0dayTokenFront.cookies\"];\n      var originalConfig = error.config;\n\n      if (!isRefreshing) {\n        isRefreshing = true;\n        api.post(\"/refresh-token\", {\n          token: refreshToken\n        }).then(function (response) {\n          var token = response.data.token;\n          setCookie(undefined, \"0dayTokenFront.token\", token, {\n            maxAge: 60 * 60 * 24 * 30,\n            //30 days\n            path: \"/\"\n          });\n          setCookie(undefined, \"0dayTokenFront.refreshToken\", response.data.refreshToken, {\n            maxAge: 60 * 60 * 24 * 30,\n            //30 days\n            path: \"/\"\n          });\n          api.defaults.headers[\"Authorization\"] = \"Bearer \".concat(token);\n          failedRequestQueue.forEach(function (request) {\n            return request.onSuccess(token);\n          });\n          failedRequestQueue = [];\n        })[\"catch\"](function (err) {\n          failedRequestQueue.forEach(function (request) {\n            return request.onFailure(err);\n          });\n          failedRequestQueue = [];\n        })[\"finally\"](function () {\n          isRefreshing = false;\n        });\n      }\n\n      return new Promise(function (resolve, reject) {\n        failedRequestQueue.push({\n          onSuccess: function onSuccess(token) {\n            originalConfig.headers[\"Authorization\"] = \"Bearer \".concat(token);\n            resolve(api(originalConfig));\n          },\n          onFailure: function onFailure(err) {\n            reject(err);\n          }\n        });\n      });\n    } else {\n      signOut();\n    }\n  }\n\n  return Promise.reject();\n});","map":null,"metadata":{},"sourceType":"module"}