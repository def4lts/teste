{"ast":null,"code":"import { createServer, Factory, Model, Response, ActiveModelSerializer } from 'miragejs';\nimport faker from 'faker';\nexport function myServer() {\n  const server = createServer({\n    // Tabelas do banco\n    models: {\n      user: Model.extend({})\n    },\n    // Permite gravar/obter dados de 2 tabelas de 1 vez\n    serializers: {\n      application: ActiveModelSerializer\n    },\n    // Geração de dados aleatórios\n    factories: {\n      user: Factory.extend({\n        name(i) {\n          return faker.name.firstName() + ' ' + faker.name.lastName(); //return `Usuário ${i + 1}`\n        },\n\n        email() {\n          return faker.internet.email();\n        },\n\n        created_at() {\n          return faker.date.recent(90); //últimos 90 dias\n        }\n\n      })\n    },\n\n    // Inclusão de dados em massa (200 usuários)\n    seeds(server) {\n      server.createList('user', 200);\n    },\n\n    routes() {\n      this.namespace = 'api';\n      this.timing = 750; // delay na chamada da API, p/ testar\n\n      this.post('/users'); // rota POST api/users              \n      //this.get('/users')  // rota GET api/users\n      // GET com paginação de 10 em 10\n\n      this.get('/users', function (schema, request) {\n        const {\n          page = 1,\n          per_page = 10\n        } = request.queryParams;\n        const totalUsers = schema.all('user').length; //retorna 200\n\n        const pageStart = (Number(page) - 1) * Number(per_page);\n        const pageEnd = pageStart + Number(per_page);\n        const users = this.serialize(schema.all('user')).users //.sort((a, b) => b.name < a.name) não funciona\n        .slice(pageStart, pageEnd);\n        return new Response(200, // status code\n        {\n          'x-total-count': String(totalUsers)\n        }, //header\n        {\n          users\n        });\n      });\n      this.get('/users/:id');\n      this.namespace = ''; // se o namespace não for 'api', não precisa disso.\n\n      this.passthrough();\n    }\n\n  });\n}","map":{"version":3,"sources":["/home/smoke/Área de Trabalho/dashgo/src/services/mirage/index.ts"],"names":["createServer","Factory","Model","Response","ActiveModelSerializer","faker","myServer","server","models","user","extend","serializers","application","factories","name","i","firstName","lastName","email","internet","created_at","date","recent","seeds","createList","routes","namespace","timing","post","get","schema","request","page","per_page","queryParams","totalUsers","all","length","pageStart","Number","pageEnd","users","serialize","slice","String","passthrough"],"mappings":"AAAA,SAASA,YAAT,EAAuBC,OAAvB,EAAgCC,KAAhC,EAAuCC,QAAvC,EAAiDC,qBAAjD,QAA8E,UAA9E;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAQA,OAAO,SAASC,QAAT,GAAoB;AACvB,QAAMC,MAAM,GAAGP,YAAY,CAAC;AAExB;AACAQ,IAAAA,MAAM,EAAE;AACJC,MAAAA,IAAI,EAAEP,KAAK,CAACQ,MAAN,CAA4B,EAA5B;AADF,KAHgB;AAOxB;AACAC,IAAAA,WAAW,EAAE;AACTC,MAAAA,WAAW,EAAER;AADJ,KARW;AAYxB;AACAS,IAAAA,SAAS,EAAE;AACPJ,MAAAA,IAAI,EAAER,OAAO,CAACS,MAAR,CAAe;AACjBI,QAAAA,IAAI,CAACC,CAAD,EAAY;AACZ,iBAAOV,KAAK,CAACS,IAAN,CAAWE,SAAX,KAAwB,GAAxB,GAA6BX,KAAK,CAACS,IAAN,CAAWG,QAAX,EAApC,CADY,CAEZ;AACH,SAJgB;;AAKjBC,QAAAA,KAAK,GAAG;AACJ,iBAAOb,KAAK,CAACc,QAAN,CAAeD,KAAf,EAAP;AACH,SAPgB;;AAQjBE,QAAAA,UAAU,GAAG;AACT,iBAAOf,KAAK,CAACgB,IAAN,CAAWC,MAAX,CAAkB,EAAlB,CAAP,CADS,CACoB;AAChC;;AAVgB,OAAf;AADC,KAba;;AA4BxB;AACAC,IAAAA,KAAK,CAAChB,MAAD,EAAS;AACVA,MAAAA,MAAM,CAACiB,UAAP,CAAkB,MAAlB,EAA0B,GAA1B;AACH,KA/BuB;;AAiCxBC,IAAAA,MAAM,GAAG;AACL,WAAKC,SAAL,GAAiB,KAAjB;AACA,WAAKC,MAAL,GAAc,GAAd,CAFK,CAEiB;;AAEtB,WAAKC,IAAL,CAAU,QAAV,EAJK,CAIiB;AACtB;AAEA;;AACA,WAAKC,GAAL,CAAS,QAAT,EAAmB,UAAUC,MAAV,EAAkBC,OAAlB,EAA2B;AAC1C,cAAM;AAAEC,UAAAA,IAAI,GAAG,CAAT;AAAYC,UAAAA,QAAQ,GAAG;AAAvB,YAA6BF,OAAO,CAACG,WAA3C;AACA,cAAMC,UAAU,GAAGL,MAAM,CAACM,GAAP,CAAW,MAAX,EAAmBC,MAAtC,CAF0C,CAEG;;AAC7C,cAAMC,SAAS,GAAG,CAACC,MAAM,CAACP,IAAD,CAAN,GAAe,CAAhB,IAAqBO,MAAM,CAACN,QAAD,CAA7C;AACA,cAAMO,OAAO,GAAGF,SAAS,GAAGC,MAAM,CAACN,QAAD,CAAlC;AAEA,cAAMQ,KAAK,GAAG,KAAKC,SAAL,CAAeZ,MAAM,CAACM,GAAP,CAAW,MAAX,CAAf,EACTK,KADS,CAEV;AAFU,SAGTE,KAHS,CAGHL,SAHG,EAGQE,OAHR,CAAd;AAKA,eAAO,IAAIrC,QAAJ,CACH,GADG,EACE;AACL;AAAE,2BAAiByC,MAAM,CAACT,UAAD;AAAzB,SAFG,EAEsC;AACzC;AAAEM,UAAAA;AAAF,SAHG,CAAP;AAKH,OAhBD;AAkBA,WAAKZ,GAAL,CAAS,YAAT;AAEA,WAAKH,SAAL,GAAiB,EAAjB,CA5BK,CA4BiB;;AACtB,WAAKmB,WAAL;AACH;;AA/DuB,GAAD,CAA3B;AAkEH","sourcesContent":["import { createServer, Factory, Model, Response, ActiveModelSerializer } from 'miragejs'\nimport faker from 'faker'\n\ntype User = {\n    name: string\n    email: string\n    created_at: string\n}\n\nexport function myServer() {\n    const server = createServer({\n\n        // Tabelas do banco\n        models: {\n            user: Model.extend<Partial<User>>({})\n        },\n\n        // Permite gravar/obter dados de 2 tabelas de 1 vez\n        serializers: {  \n            application: ActiveModelSerializer\n        },\n\n        // Geração de dados aleatórios\n        factories: {  \n            user: Factory.extend({\n                name(i: number) {\n                    return faker.name.firstName() +' '+ faker.name.lastName()\n                    //return `Usuário ${i + 1}`\n                },\n                email() {\n                    return faker.internet.email()\n                },\n                created_at() {\n                    return faker.date.recent(90) //últimos 90 dias\n                }\n            })\n        },\n\n        // Inclusão de dados em massa (200 usuários)\n        seeds(server) {  \n            server.createList('user', 200)\n        },\n\n        routes() {\n            this.namespace = 'api' \n            this.timing = 750     // delay na chamada da API, p/ testar\n            \n            this.post('/users')   // rota POST api/users              \n            //this.get('/users')  // rota GET api/users\n\n            // GET com paginação de 10 em 10\n            this.get('/users', function (schema, request) {\n                const { page = 1, per_page = 10} = request.queryParams\n                const totalUsers = schema.all('user').length //retorna 200\n                const pageStart = (Number(page) - 1) * Number(per_page)\n                const pageEnd = pageStart + Number(per_page)\n                \n                const users = this.serialize(schema.all('user'))\n                    .users\n                    //.sort((a, b) => b.name < a.name) não funciona\n                    .slice(pageStart, pageEnd)\n\n                return new Response(\n                    200, // status code\n                    { 'x-total-count': String(totalUsers) }, //header\n                    { users }\n                )\n            })\n            \n            this.get('/users/:id')\n            \n            this.namespace = ''   // se o namespace não for 'api', não precisa disso.\n            this.passthrough()    \n        }\n\n    })\n}\n"]},"metadata":{},"sourceType":"module"}